import getObject from './getObject.js';
import { URL } from 'url';

export default function(result) {
  let scripts = getObject(result.html, 'type', 'script');
  let stylesheets = getObject(result.html, 'name', 'link');

  scripts = scripts.filter((script) => {
    return script.hasOwnProperty('attribs') && script.attribs.hasOwnProperty('src');
  });

  stylesheets = stylesheets.filter((stylesheet) => {
    return stylesheet.hasOwnProperty('attribs') && stylesheet.attribs.hasOwnProperty('rel') && stylesheet.attribs.rel === 'stylesheet';
  });

  const origin = (new URL(result.url)).origin;

  scripts = scripts.map((script) => {
    if (!script.attribs.src.startsWith('http') && script.attribs.src.startsWith('./')) {
      // this is tricky one
    }
    if (!script.attribs.src.startsWith('http') && script.attribs.src.startsWith('/')) {
      return origin + script.attribs.src;
    }
    if (!script.attribs.src.startsWith('http')) {
      return origin + '/' + script.attribs.src;
    }

    return script.attribs.src;
  });

  stylesheets = stylesheets.map((stylesheet) => {
    if (!stylesheet.attribs.href.startsWith('http') && stylesheet.attribs.href.startsWith('./')) {
      // this is tricky one
    }
    if (!stylesheet.attribs.href.startsWith('http') && stylesheet.attribs.href.startsWith('/')) {
      return origin + stylesheet.attribs.href;
    }
    if (!stylesheet.attribs.href.startsWith('http')) {
      return origin + '/' + stylesheet.attribs.href;
    }
    return stylesheet.attribs.href;
  });

  return scripts.concat(stylesheets);
}
