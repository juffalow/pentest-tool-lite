import Test, { TestParameters, Result } from '../Test';
import request from '../request';
import logger from '../logger';

/**
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection
 */
class XXSSProtection extends Test {
  public name = 'X-XSS-Protection';

  public async test({ url }: TestParameters): Promise<Result> {
    logger.info('Starting X-XSS-Protection test...');
    const response = await request.get(url);

    if (!Object.prototype.hasOwnProperty.call(response.headers, 'x-xss-protection')) {
      return {
        status: 'ERROR',
        title: 'X-XSS-Protection',
        description: 'Response headers does not contain x-xss-protection header!',
      };
    }

    return {
      status: 'SUCCESS',
      title: 'X-XSS-Protection',
      description: `The value of x-xss-protection header is ${response.headers['x-xss-protection']}.`,
    };
  }
}

export default XXSSProtection;
