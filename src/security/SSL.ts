import sslChecker from 'ssl-checker';
import Test, { TestParameters, Result } from '../Test';
import logger from '../logger';

class SSL extends Test {
  public name = 'SSL';

  public async test({ url }: TestParameters): Promise<Result> {
    logger.info('Starting SSL test...');
    const hostname = (new URL(url)).hostname;
    const sslDetails = await sslChecker(hostname);

    if (!sslDetails.valid) {
      return {
        status: 'ERROR',
        title: this.name,
        description: 'SSL certificate is not valid!',
      };
    }

    if (sslDetails.daysRemaining <= 7) {
      return {
        status: 'WARNING',
        title: this.name,
        description: 'SSL certificate is valid for 7 or less days!',
      };
    }

    return {
      status: 'SUCCESS',
      title: this.name,
      description: `SSL certificate is valid until ${sslDetails.validTo}.`,
    };
  }
}

export default SSL;
