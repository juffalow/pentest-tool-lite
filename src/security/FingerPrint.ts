import Test from '../Test';

/**
 * 
 * @see https://www.owasp.org/index.php/Fingerprint_Web_Server_(OTG-INFO-002)
 * @see https://www.owasp.org/index.php/Fingerprint_Web_Application_Framework_(OTG-INFO-008)
 */
class FingerPrint extends Test {
  protected request: RequestInterface;

  protected logger: LoggerInterface;

  protected knownHeaders: Array<string> = [ 'x-powered-by', 'x-generator', 'server' ];

  constructor(request: RequestInterface, logger: LoggerInterface) {
    super();
    this.request = request;
    this.logger = logger;
  }

  async run(url: string): Promise<ResultInterface> {
    this.logger.info('Starting FingerPrint test...');
    const result = await this.request.get(url, false);

    if (this.hasFingerPrintHeader(result.response.headers)) {
      return this.getResult('FingerPrint', 'UNSUCCESSFUL');
    }
    return this.getResult('FingerPrint', 'SUCCESSFUL');
  }

  private hasFingerPrintHeader(headers: Object): boolean {
    return Object.keys(headers).filter(header => this.knownHeaders.includes(header)).length > 0;
  }
}

export default FingerPrint;
