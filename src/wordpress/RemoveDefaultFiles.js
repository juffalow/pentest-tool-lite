// @flow
import Result, { TYPE_OK, TYPE_INCORRECT, TYPE_ERROR } from '../pentest/Result';

export default class RemoveDefaultFiles {
  request: Object;
  logger: Object;
  
  /**
   * 
   * @param {Function} fetch
   */
  constructor(request: Object, logger: Object) {
    this.request = request;
    this.logger = logger;
  }

  /**
   * 
   * @param {string} url
   * @returns {Promise}
   */
  async execute(url: string): Promise<Object> {
    this.logger.verbose('Executing RemoveDefaultFiles test...');

    let tests = [];
    let listOfFiles: Array<string> = [
        '/readme.html',
        '/licence.txt',
        '/wp-config-sample.php',
        '/wp-admin/install.php',
        '/wp-admin/upgrade.php',
    ];

    listOfFiles.forEach(async (element) => {
        const urlOfFile = url + element;
        const result = await this.request.get(urlOfFile);

        if (result.response.statusCode === 404) {
            tests = [...tests, new Result(urlOfFile, TYPE_OK)];
        }
        else if (result !== null) {
            tests = [...tests, new Result(urlOfFile, TYPE_ERROR)];
        } else {
            tests = [...tests, new Result(urlOfFile, TYPE_OK)];
        }
    });
    
    return new Result(url, TYPE_OK, tests);
  }
}