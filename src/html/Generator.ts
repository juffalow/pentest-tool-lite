import Test, { TestParameters, Result } from '../Test';
import request from '../request';
import logger from '../logger';
import { parseHtml, getGenerator } from '../functions';

class Generator extends Test {
  public name = 'Generator';

  public async test({ url }: TestParameters): Promise<Result> {
    logger.info('Starting DuplicateId test...');
    const response = await request.get(url);
    const html = await parseHtml(response);
    const generators = await getGenerator(html);

    if (generators.length > 0) {
      return {
        status: 'WARNING',
        title: this.name,
        description: 'Page contains inmformation about its generator!',
      };
    }

    return {
      status: 'SUCCESS',
      title: this.name,
      description: 'Page doesn\t contain any information about its generator.',
    };
  }
}

export default Generator;
