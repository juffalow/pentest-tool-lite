import Test, { TestParameters, Result } from '../Test';
import request from '../request';
import logger from '../logger';
import { getDuplicates } from '../functions';

class DuplicateId extends Test {

  public async test({ url }: TestParameters): Promise<Result> {
    logger.info('Starting DuplicateId test...');
    const response = await request.get(url);
    const duplicates = await getDuplicates(response);

    if (duplicates.length > 0) {
      return {
        status: 'WARNING',
        title: 'Duplicate IDs',
        description: '',
        results: duplicates.map(duplicate => ({
          status: 'WARNING',
          title: `<${duplicate.name} id="${duplicate.attribs.id}" ... />`,
          description: '',
        }))
      };
    }

    return {
      status: 'SUCCESS',
      title: 'Duplicate IDs',
      description: ''
    };
  }
}

export default DuplicateId;
