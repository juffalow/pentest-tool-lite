import Test, { TestParameters, Result } from '../Test';
import A from './A';
import NS from './NS';
import DMARC from './DMARC';
import RegistrationDate from './RegistrationDate';

export default class DNS extends Test {
  public name = 'DNS';

  constructor() {
    super();
    this.tests = [
      new RegistrationDate(),
      new NS(),
      new A(),
      new DMARC(),
    ];
  }

  public async test(params: TestParameters): Promise<Result> {
    const tests = this.getTests();
    const results = [];

    for (const test of tests) {
      let result = null;

      try {
        result = await test.run(params);
      } catch (error) {
        result = {
          status: 'ERROR',
          title: test.name,
          description: 'Test failed or cannot be run!',
        }
      }

      results.push(result);
    }

    return {
      status: this.getStatus(results.map(result => result.status)),
      title: this.name,
      description: '',
      results,
    };
  }
}
