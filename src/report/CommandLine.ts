import Symbols from './Symbols';
import { Result } from '../Test';
import config from '../config';

class CommandLine {
  public write(results: Array<Result>, level = 0): void {
    results.forEach((result) => {
      const r = result.results;

      if ((typeof r !== 'undefined' && r.length > 0) || level > 0) {
        this.print(result.title, result.status, level);
        if (config.report.type === 'FULL' && 'description' in result && result.description.length > 0) {
          this.printDescription(result.description, level);
        }
      }

      if (typeof r !== 'undefined') {
        this.write(r, level + 1);
      }
    });
  }

  public print(message: string, status: string, level: number): void {
    console.log('%s%s  %s', Array(level * 4).join(' '), this.getFormattedSymbol(status), message);
  }

  public printDescription(description: string, level: number): void {
    console.log('%s   %s', Array(level * 4).join(' '), description);
  }

  public getFormattedSymbol(status: string): string {
    switch (status) {
      case 'SUCCESS':
        return '\x1b[32m' + Symbols.success + '\x1b[0m';
      case 'WARNING':
        return '\x1b[33m' + Symbols.warning + '\x1b[0m';
      case 'ERROR':
      case 'FATAL':
        return '\x1b[31m' + Symbols.error + '\x1b[0m';
    }
    return '\x1b[34m' + Symbols.info + '\x1b[0m';
  }
}

export default CommandLine;
